<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diet Goal App</title>
<style>
body { font-family: sans-serif; padding:20px; background:#f5f5f5; }
h1 { font-size:22px; }
button { padding:10px; margin-top:5px; }
.goal { background:white; padding:15px; margin-top:10px; border-radius:10px; }
</style>
</head>
<body>

<h1>ダイエット目標管理</h1>

<input id="goalName" placeholder="目標名（例：スイーツ）">
<input id="goalLimit" type="number" placeholder="週の回数">
<button onclick="addGoal()">目標追加</button>

<div id="goals"></div>

<script>
let goals = JSON.parse(localStorage.getItem("goals")) || [];

function save() {
  localStorage.setItem("goals", JSON.stringify(goals));
}

function addGoal() {
  const name = document.getElementById("goalName").value;
  const limit = parseInt(document.getElementById("goalLimit").value);
  if(!name || !limit) return;
  goals.push({name, limit, count:0, fails:0, start:Date.now()});
  save();
  render();
}

function checkGoal(index) {
  goals[index].count++;
  if(goals[index].count > goals[index].limit) {
    goals[index].fails++;
  }
  save();
  render();
}

function render() {
  const container = document.getElementById("goals");
  container.innerHTML = "";
  goals = goals.filter(g => g.fails < 3);
  goals.forEach((g,i) => {
    container.innerHTML += `
      <div class="goal">
        <b>${g.name}</b><br>
        制限：週${g.limit}回<br>
        今日の回数：${g.count}<br>
        失敗回数：${g.fails}<br>
        <button onclick="checkGoal(${i})">食べた</button>
      </div>
    `;
  });
}

render();

if ("Notification" in window) {
  Notification.requestPermission();
  setInterval(() => {
    const now = new Date();
    if (now.getHours() === 21 && now.getMinutes() === 0) {
      new Notification("今日の記録をチェック！");
    }
  }, 60000);
}
</script>

</body>
</html>
